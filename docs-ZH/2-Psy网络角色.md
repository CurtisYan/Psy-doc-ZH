# Psy 网络中的角色

对 Psy 上的矿工、用户及其他角色的高层简介

## Psy 中的网络角色

Psy 区块链通过一个去中心化的参与者网络来运作，每个参与者都扮演着对网络功能、安全性、可扩展性和韧性至关重要的特定角色。这些角色通过 Psy 的**有用工作量证明（PoUW）**机制获得激励，确保网络贡献能够直接惠及其用户和整体生态的健康。对于开发者而言，理解这些角色是掌握 Psy 生态系统运作方式及其应用程序如何与底层基础设施互动的关键。

Psy 中主要有六种网络角色：

1. **用户 (Agents)**
2. **证明矿工 (Proof Miners)**
3. **协调者 (Coordinators)**
4. **领域节点 (Realms)**
5. **数据可用性矿工 (DA Miners)**
6. **（隐含的）网络先锋 (Network Vanguards)**

## 1. 用户 (Agents)

用户，在 Psy 以代理为中心的架构中也被概念化为“代理”（Agents），是发起区块链状态变更的主要行动者。他们是交易和智能合约交互的消费者与发起者。

#### **核心职能与特性:**

- **本地交易执行与证明**:
  - 与传统区块链中用户向内存池提交交易等待网络执行不同，Psy 的用户（或其客户端软件/委托方）在**本地**执行他们的智能合约调用（合约函数电路 - CFCs）。
  - 对于每笔交易，都会在本地生成一个零知识证明（ZKP），以证实合约逻辑的正确执行。
  - 在一次**用户证明会话（UPS）**中，多个本地交易证明会被递归地组合成一个单一、紧凑的“**End Cap**”证明。这个 End Cap 证明总结了该用户在特定区块内的所有活动。
- **状态交互**:
  - Psy 采用 PARTH 状态模型。每个用户为他们与之交互的每个合约都拥有自己隔离的状态树（`CSTATE` 树，聚合在其 `UCON` 树下）。
  - 用户的交易**只能写入其自身的状态树**。
  - 用户可以**读取任何全局状态**（例如，其他用户的余额或合约状态），但只能读取**上一个区块**已最终确定的状态。
- **可编程公钥 (SDKeys)**:
  - 用户的身份不与固定的加密方案（如 secp256k1）绑定。相反，用户在 Psy 上的“公钥”是其选择的任意 ZK 电路（即“签名电路”）的**验证者数据的哈希**加上一个用户自定义的参数。
  - 这个签名电路定义了为用户的 End Cap 证明生成有效签名（其本身也是一个 ZK 证明）所需满足的条件。
  - 这使得以下成为可能：
    - 支持现有钱包签名（例如，以太坊、比特币）。
    - 自定义多因素认证、N/M 多重签名。
    - 将消费限额、时间锁或其他逻辑直接嵌入密钥中。
    - **自治代理**：可以无需私钥即可运行的账户，其签名生成纯粹是交易内容和区块链状态的函数。这对于创建链上 AMM、预言机或 AI 驱动的实体是革命性的。
- **提交证明与增量数据**:
  - 完成一次 UPS 后，用户向一个 Realm 节点提交他们的 End Cap 证明以及相应的**状态增量**（即其 `CSTATE` 叶子节点的实际变更值）。

#### **激励**:

用户不直接通过 PoUW 获得激励，但他们是网络服务（安全、可扩展、私密的计算和状态）的主要受益者。他们支付的交易费用为激励其他网络角色做出了贡献。

#### **为何这对其他用户/开发者有用**:

- **隐私**：在本地交易执行中使用的敏感数据永远不会以未加密形式离开用户设备。
- **控制与灵活性**：SDKeys 赋予用户对其账户安全和功能前所未有的控制权。
- **可扩展性**：本地证明为核心网络分担了巨大的计算负担。
- **代理化的可能性**：开发者可以设计出包含真正链上自治组件的应用程序。

## 2. 证明矿工 (Proof Miners)

证明矿工是 Psy 的 ZK-rollup 式架构的**计算骨干**。他们执行聚合用户证明和最终化区块状态转换所需的高强度零知识证明生成工作。

#### **核心职能:**

- **聚合用户证明 (GUTA)**:
  - 证明矿工接收 End Cap 证明（由用户提交给 Realms），并使用专门的 ZK 电路（GUTA - 全局用户树聚合电路）进行递归聚合。
  - 此聚合过程通常涉及验证一对证明（两个 End Cap 证明或两个较低级别的 GUTA 证明），并生成一个新的、单一的证明，该证明不仅证实了两个子证明的有效性，还证明了在全局用户树（`GUSR`）中其**最近公共祖先（NCA）**处的正确状态转换。
  - 这个过程分层级地持续进行，直到一个 Realm 为其 `GUSR` 分段内的所有用户活动生成一个单一的 GUTA 证明。
- **聚合 Realm 及全局证明**:
  - 协调者引导证明矿工进一步聚合来自不同 Realms 的 GUTA 证明。
  - 他们还为全局操作生成证明，例如新合约部署（`BatchDeployContractsCircuit`）和新用户注册（`BatchAppendUserRegistrationTreeCircuit`）。
- **生成最终区块证明**:
  - 最终，证明矿工生成 `PsyCheckpointStateTransitionCircuit` 证明。这是整个区块的单一 ZK 证明，它验证了所有聚合的 GUTA、合约部署和用户注册证明。至关重要的是，它还验证了**上一个区块的证明**，从而创建了一条从创世区块开始的、不间断的密码学有效性链。

#### **激励**:

- 非状态交易费用的百分比:

  证明矿工会获得他们帮助聚合的 End Cap 证明中非状态交易费用的一部分。分配比例与他们在区块内成功聚合的证明数量成正比，确保贡献越多的矿工收入越多。

  - `矿工_k_的奖励 = min(区块_n_中支付的总非状态交易费, 区块奖励下限) * (矿工_k_在区块_n_中聚合的证明数 / 区块_n_中聚合的总证明数) * C` （其中 C 是一个接近 1 的常数）。

- **固定的每区块奖励下限**: 每个区块的基线奖励确保了网络的稳定性，并激励矿工在交易量较低时段也能参与。

#### **为何他们的工作对用户/开发者有用**:

- **实现无需信任的验证**：他们的主要效用是将可能数百万个独立的用户交易证明，转化为一个单一、小巧且可快速验证的区块证明。这使得任何人（即使在轻客户端或智能手表上）都可以在几毫秒内核验从创世区块至今的整个 Psy 区块链状态。
- **可扩展性引擎**：网络处理更多交易的能力与证明矿工可用的计算能力直接相关。更多的证明矿工意味着更多的并行证明聚合，从而带来更高的吞吐量。
- **安全性**：通过生成这些复杂的 ZKP，他们是 Psy“数学证明”安全模型不可或缺的一部分。
- **激励对齐**：证明矿工被激励尽可能快速、高效地处理用户证明，因为他们的奖励与他们执行的有用工作（聚合）量成正比。这通过确保用户的交易被纳入并最终化，直接惠及了用户。

## 3. 协调者 (Coordinators)

协调者在 Psy 网络中扮演着**高层编排者**的角色。他们管理整个区块的构建过程，在 Realms、证明矿工和全局状态组件之间进行协调。虽然他们扮演着关键角色，但他们自己**不验证交易**，而是管理证明聚合的工作流程。

#### **核心职能:**

- **接收 Realm 证明**：收集当前区块所有活跃 Realms 的聚合 GUTA 证明。
- **编排最终聚合**:
  - 将这些 Realm GUTA 证明，连同全局操作的见证数据（用户注册、合约部署），提交到去中心化的证明矿工网络进行进一步聚合，形成“第一部分”证明（例如 `VerifyAggUserRegistartionDeployContractsGUTACircuit`）。
- **管理全局状态组件**:
  - 存储并提供已部署智能合约的代码（字节码）及其 `CFT`（合约函数树）根，后者用作有效函数指纹的白名单。
  - 存储每个用户公钥的副本（其签名电路的验证者数据 + 参数的哈希），并用于批量追加注册记录的证明处理。
  - 维护**检查点树（CHKP）**，一个只追加的 Merkle 树，其中第 N 个叶子是第 N 个区块的 `CHKP` 根。
  - 存储**全局用户树（GUSR）的顶层**，其中每个叶子指向一个 Realm 的 `GUSR` 子树根。
- **处理全局操作**:
  - 处理新用户注册和智能合约部署的 API 请求。
  - 为这些操作的 ZK 证明生成见证数据（`BatchAppendUserRegistrationTreeCircuit`、`BatchDeployContractsCircuit`）。
- **最终区块证明编排**:
  - 为最终的区块证明（`PsyCheckpointStateTransitionCircuit`）生成见证数据。
  - 将这个最终的证明任务分派给证明矿工网络。
  - 存储并分发最新的最终区块证明。
- **区块定时与同步**：负责设定“滴答作响”的区块时间，并在每个区块后向 Realms 同步关键数据（如最新的 `CHKP` 根）。

#### **激励**:

- **非状态交易费用的百分比**：协调者从他们成功协调的区块中包含的所有交易里，获得一部分非状态交易费用。

#### **为何他们的工作对用户/开发者有用**:

- **确保区块最终化**：他们对于将所有由用户和 Realms 完成的并行工作汇集到一个单一、连贯且可证明的区块中至关重要。
- **全局状态一致性**：他们维护着对智能合约和用户身份功能运作所必需的关键全局数据结构（如 `GCON` 和 `URT`）。
- **促进网络增长**：通过处理用户注册和合约部署，他们使网络得以扩展。
- **激励对齐**：协调者被激励最大化每个区块中包含的用户交易数量。这意味着他们会努力与 Realms 高效通信，快速地将证明任务分派给证明矿工，并保证合约代码等关键数据的高可用性，所有这些都有益于用户和 dApp 开发者。

## 4. 领域节点 (Realms)

Realms 是用户交易和状态的**分布式接收点和初始聚合点**。他们管理全局用户树（`GUSR`）的特定分段（分片）。

#### **核心职能:**

- **接收用户提交**:
  - 用户向负责其用户 ID 范围的 Realm 提供的 API 端点提交他们的 End Cap 证明和相应的状态增量。
- **初始证明聚合 (GUTA)**:
  - Realms 验证收到的 End Cap 证明。
  - 他们为这些 End Cap 证明生成见证数据，并提交到去中心化的证明矿工网络，以使用 GUTA 电路进行聚合（例如 `GUTAVerifySingleEndCapCircuit`、`GUTAVerifyTwoEndCapCircuit`）。
  - 这种聚合在 Realm 内部递归进行，直到生成一个单一的 GUTA 证明，该证明代表了该 Realm 整个 `GUSR` 分段在该区块的净状态转换。
- **状态增量管理**:
  - 存储从用户处收到的状态增量。
  - 将这些状态增量中继给与该 Realm 对等的**数据可用性（DA）矿工**，确保数据的持久性和可访问性。
- **数据服务**:
  - 为在其分配的 `GUSR` 分段内的用户存储并提供用户特定的数据。这包括 Realm 所负责部分的 `GUSR`、每个用户的 `ULEAF` 数据，以及这些用户的所有 `UCON` 和 `CSTATE` 树。这些数据对于用户构建新交易的证明至关重要。
- **提交 Realm 证明**：将他们最终聚合的 Realm GUTA 证明发送给协调者，以包含在整体区块证明中。

#### **激励**:

- **非状态交易费用的百分比**：来自在其 Realm 内处理交易的用户。
- **状态交易费用的百分比**：来自其 Realm 内的用户，反映了其存储和数据服务的成本。

#### **为何他们的工作对用户/开发者有用**:

- **可扩展的接收点**：通过对用户提交进行分片，Realms 防止了单一的拥堵点。
- **为本地证明提供数据可访问性**：他们（与 DA 矿工一起）为用户提供了执行和证明其本地交易所必需的历史状态数据。
- **高效的用户体验**：Realms 被激励为其用户提供快速、可靠的服务，包括快速接收 End Cap 证明和高效的数据检索，因为他们的收入依赖于其分段内的用户活动。
- **去中心化聚合**：他们启动了分布式证明聚合过程，为网络的整体可扩展性和安全性做出了贡献。
- **无反用户的 MEV**：与协调者一样，Realms 只有在他们的用户成功交易时才能赚钱。没有激励结构让他们从事抢跑或其他在其他平台上常见的剥削性行为。

## 5. 数据可用性矿工 (DA Miners)

DA 矿工负责 Psy 区块链状态的**稳健和去中心化存储**，特别是细粒度的用户合约状态（`CSTATE`）数据。

#### **核心职能:**

- **存储链上数据**:
  - 从 Realms 接收状态增量。
  - 存储并维护用户 `CSTATE` 树及其他相关区块链状态数据的副本。
- **证明数据可用性**:
  - DA 矿工必须定期生成 ZK 证明，以证实他们正确存储了被随机抽查的特定数据片段（例如，某个用户 `CSTATE` 树或全局状态树中随机叶子的 Merkle 证明）。
- **向用户提供数据**:
  - 将存储的状态数据提供给需要它来构建交易证明的用户（通常通过 Realms）。

#### **激励**:

- **状态交易费用的一部分**：根据成功证明存储了随机抽查的数据而获得奖励。这确保了他们被激励去正确、全面地存储数据。
- **来自关联 Realms 的费用**：DA 矿工可以与特定的 Realms 对等，并从这些 Realms 赚取的费用中分得一杯羹，从而激励他们为这些 Realms 的用户高效地提供数据。

#### **为何他们的工作对用户/开发者有用**:

- **数据持久性与韧性**：DA 矿工确保所有区块链状态都被冗余存储，并能抵抗丢失或审查。这对链的长期完整性至关重要。
- **为证明提供可访问性**：他们保证用户总能检索到证明新交易所必需的历史状态，这是 Psy 本地证明模型的基础。
- **抗审查**：去中心化的数据存储使得任何单一实体都极难审查或拒绝访问区块链数据。
- **开放可验证的账本**：他们的工作支撑了任何人独立验证余额和智能合约信息的能力。

## 6. 网络先锋 (Network Vanguards) (协议执行者)

网络先锋并非像其他角色那样持续运行的节点，而是通过**监控和干预**能力，在维护网络健康、公平和效率方面扮演着至关重要的角色。

#### **核心职能:**

- **A 类 (Realm 对等/同步监控)**:
  - 监控和测试运行特定 Realm 的多个去中心化运营商之间的实时对等和数据同步效率。（Realms 由一组轮换的实体运营）。
- **B 类 (协调者对等/同步监控)**:
  - 监控和测试履行协调者角色的多个去中心化运营商之间的实时对等和数据同步效率（该角色也是轮换的）。
- **C 类 (反审查的最后防线)**:
  - 如果一个 Realm 似乎在审查用户的交易（即，不包含他们有效的 End Cap 证明），C 类先锋可以在链上提供这个有效但未被包含的交易的证明。
  - 这会迫使进行审查的 Realm 运营商要么在后续区块中包含该交易，要么冒着失去该 Realm 的运营资格（以及可能被罚没的押金）的风险。

#### **激励**:

- **固定的非状态费用份额**：一小部分固定的区块奖励被分配给先锋，作为他们持续监控服务的报酬。
- **罚没奖励 (针对 C 类)**：如果一个 C 类先锋因 Realm 运营商违规而成功强制纳入了一笔被审查的交易，他们可能会从违规 Realm 运营商被罚没的押金中获得一部分。

#### **为何他们的工作对用户/开发者有用**:

- **网络健康与效率**：A 类和 B 类有助于确保去中心化运营商之间的底层通信基础设施是稳健和高性能的，这对于低延迟和高吞吐量至关重要。
- **抗审查**：C 类先锋提供了一个强大的机制来威慑和惩罚 Realm 级别的审查行为，确保所有用户都能公平访问。这是一个真正开放和无需许可的平台的关键保证。
- **维护协议完整性**：他们扮演着“监察者”的角色，确保关键基础设施（Realms, Coordinators）的去中心化运营商遵守协议规则。

通过分配这些职责并通过 PoUW 对齐激励，Psy 创建了一个稳健、可扩展且以用户为中心的生态系统，其中每个参与者都为网络的成功做出了有意义的贡献。